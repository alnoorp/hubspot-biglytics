<!--
  templateType: blog
  isAvailableForNewContent: true
  label: Blog Listing
  scopes:
    - cms-hub-website-theme-access
  screenshotPath: ../images/template-previews/blog-index.png
-->
{% extends "./layouts/base.html" %}

{% block body %}
<main class="body-container-wrapper">
  <div class="body-container body-container-blog-index">

    {% module "blog_listing_banner"
      path="../modules/Blog Listing Banner",
      blog_listing_banner_image={
        "src": get_asset_url("../images/blog-banner.png")
      }
    %}

    <div class="blog-navigation">
      <div class="content-wrapper">
        <div class="row-fluid span12">
          <div class="blog-navigation__tag-filter column span6">
            {% module "blog_tag_filter" path="../modules/Blog Tag Filter" %}
          </div>
          <div class="blog-navigation__search column span6">
            {% module "blog_search" path="@hubspot/search_input", label="Blog Search" %}
          </div>
        </div>
      </div>
    </div>

    <div class="content-wrapper">
      <section class="blog-index">
        {% for content in contents %}
            <article class="blog-card">
              <div class="blog-card__header">
                <h2 class="blog-card__title"><a href="{{ content.absolute_url }}">{{ content.name }}</a></h2>
                {% if content.blog_author.avatar %}
                  <div class="blog-card__author-image" style="background-image: url('{{ content.blog_author.avatar }}');"></div>
                {% endif %}
                <div class="blog-card__meta">
                    <a class="blog-card__author-name" href="{{ group.absolute_url }}/author/{{ content.blog_post_author.slug }}">{{ content.blog_post_author.display_name }}</a>
                    <span class="blog-card__date">{{ content.publish_date_localized }}</span>
                </div>
              </div>
              <div class="blog-card__body">
                {% if content.featured_image %}
                  <a class="blog-card__image" style="background-image: url('{{ content.featured_image }}')"; href="{{ content.absolute_url }}"></a>
                {% endif %}
                <div class="blog-card__content">
                  {% if content.tag_list %}
                    <div class="blog-card__tags">
                        {% icon name="tag" style="SOLID" %}
                        {% for tag in content.tag_list %}
                          <a class="blog-card__tag-link" href="{{ blog_tag_url(group.id, tag.slug) }}">{{ tag.name }}</a>
                        {% endfor %}
                    </div>
                  {% endif %}
                  {{ content.post_list_content|truncatehtml(170) }}
                </div>
              </div>
              <div class="blog-card__footer">
                <a class="blog-card__button button button__primary" href="{{ content.absolute_url }}">Read More</a>
                <div class="blog-card__comment-count">
                    {% set comments_number =  content.comment_list|length %}
                    {% set comments_label = "Comment" if comments_number == 1 else "Comments" %}
                    {{ comments_number }} {{ comments_label }}
                </div>
              </div>
            </article>
        {% endfor %}
      </section>
      {% if contents.total_page_count > 1 %}
        <div class="blog-pagination">
          {% set page_list = [-2, -1, 0, 1, 2] %}
          {% if contents.total_page_count - current_page_num == 1 %}{% set offset = -1 %}
          {% elif contents.total_page_count - current_page_num == 0 %}{% set offset = -2 %}
          {% elif current_page_num == 2 %}{% set offset = 1 %}
          {% elif current_page_num == 1 %}{% set offset = 2 %}
          {% else %}{% set offset = 0 %}{% endif %}

          <a class="blog-pagination__link blog-pagination__prev-link {{ 'blog-pagination__prev-link--disabled' if !last_page_num }}" href="{{ blog_page_link(last_page_num) }}">
            {% icon name="chevron-left" style="SOLID", width="13", no_wrapper=True %}
            Prev
          </a>
          {% for page in page_list %}
            {% set this_page = current_page_num + page + offset %}
            {% if this_page > 0 and this_page <= contents.total_page_count %}
              <a class="blog-pagination__link blog-pagination__number-link {{ 'blog-pagination__link--active' if this_page == current_page_num }}" href="{{ blog_page_link(this_page) }}">{{ this_page }}</a>
            {% endif %}
          {% endfor %}
          <a class="blog-pagination__link blog-pagination__next-link {{ 'blog-pagination__next-link--disabled' if !next_page_num }}" href="{{ blog_page_link(current_page_num + 1) }}">
            Next
            {% icon name="chevron-right" style="SOLID", width="13", no_wrapper=True %}
          </a>
        </div>
      {% endif %}
    </div>
  </div>
</main>
{% endblock body %}
